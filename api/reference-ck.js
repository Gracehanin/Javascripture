/*globals javascripture bible*/javascripture.api.reference={getThreeChapters:function(e){var t=this,n=e.book,r=e.chapter,i=e.verse,s=t.getOffsetChapter(e,-1),o=t.getOffsetChapter(e,1),u='<div class="three-references"';s.book&&(u+=" data-prev='"+JSON.stringify(s)+"'");o.book&&(u+=" data-next='"+JSON.stringify(o)+"'");u+=">";s.book&&(u+=javascripture.api.reference.getChapterText(s));u+=javascripture.api.reference.getChapterText(e);o.book&&(u+=javascripture.api.reference.getChapterText(o));u+="</div>";return u},getChapterData:function(e){var t=this,n=e.book,r=e.chapter,i=e.verse,s=r-1,o={};javascripture.data.hebrew[n]?testament="hebrew":testament="greek";if(javascripture.data[e.version][n][s]){o.translation=javascripture.data[e.version][n][s];javascripture.data[testament][n]&&javascripture.data[testament][n][s]&&(o.original=javascripture.data[testament][n][s])}return o},getChapterText:function(e){var t=this,n=e.book,r=e.chapter,i=e.verse,s=r-1,o=i-1,u=!1,a='<div class="reference frequencyAnalysis" data-book="'+n+'" data-chapter="'+r+'"><h1>'+n+" "+r+"</h1>";a+='<ol class="wrapper">';javascripture.data.hebrew[n]?testament="hebrew":testament="greek";var f=t.getChapterData(e);f.translation&&f.translation.forEach(function(i,s){a+='<li id="'+n.replace(/ /gi,"_")+"_"+r+"_"+(s+1)+'"';s===o&&(a+=' class="current"');a+='data-verse="'+(s+1)+'">';a+='<div class="wrapper"';s===o&&(a+=' id="current"');if(s===o-5){a+=' id="context"';u=!0}a+=">";a+='<div class="english">';e.version==="lc"?f.original[s].forEach(function(n,r){n&&(a+=t.createWordString(n,"english",testament,e.version))}):f.translation[s].forEach(function(n,r){n&&(a+=t.createWordString(n,"english",testament,e.version))});a+="</div>";if(f.original[s]){a+="<div class='original "+testament+"'>";f.original[s].forEach(function(e,n){e&&(a+=t.createWordString(e,testament,testament))});a+="</div>"}a+="</div>";a+="</li>"});a+="</ol>";a+="</div>";return a},createWordString:function(e,t,n,r){var i=this,s="",o=[];if(typeof e[1]=="undefined")return"<span>"+e[0]+"</span> ";lemma=e[1];if(lemma){lemmaArray=lemma.split(" ");lemmaArray.forEach(function(e,t){o.push(javascripture.api.word.getFamily(e))})}s+="<span";s+=' class="'+o.join(" ")+'"';s+=' title="'+lemma;e[2]&&(s+=" "+e[2]);s+='"';s+=' data-word="'+e[0]+'"';s+=' data-lemma="'+e[1]+'"';s+=' data-language="'+n+'"';s+=' data-range="verse"';s+=' data-family="'+o.join(" ")+'"';e[2]&&(s+=' data-morph="'+e[2]+'"');s+=">";r==="lc"&&t==="english"?s+=javascripture.modules.translateLiterally.getWord(e):s+=e[0];s+="</span> ";return s},getOffsetChapter:function(e,t){var n=e.book,r=e.chapter,i={version:e.version},s=parseInt(r,10)+t,o=s-1,u;if(javascripture.data[e.version][n]&&javascripture.data[e.version][n][o]!==undefined){i.book=n;i.chapter=s}else bible.Data.books.forEach(function(e,r){if(e[0]===n){u=r+t;if(bible.Data.books[u]!==undefined){i.book=bible.Data.books[u][0];t>0?i.chapter=1:i.chapter=bible.Data.verses[u].length}}});return i}};