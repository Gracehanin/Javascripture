/*global javascripture*/(function(e){javascripture.modules.wordPanel={init:function(t){var n=this;if(!t.data("lemma"))return!1;var r=t.data("lemma").split(" "),i="",s="",o="",u="",a="",f="",l=[],c,h=t.data("morph");e.each(r,function(r,p){if(p!=="G3588"){if(p!=="added"&&p!=="trans-change"){i=p;var d=javascripture.modules.reference.getFamily(p),v=p;s=javascripture.modules.hebrew.stripPointing(javascripture.data.strongsDictionary[v].lemma);o=javascripture.data.strongsDictionary[v].strongs_def;u=javascripture.data.strongsDictionary[v].derivation;var m=javascripture.data.strongsDictionary[v].kjv_def.split(",");e.each(m,function(e,t){var n=t.trim();a+='<a href="#" class="kjv-def" data-language="english" data-clusivity="exclusive" data-range="word" data-lemma="'+p+'" data-word="'+n+'">'+n+"</a>, "});f=t.text();v.substring(0,1)==="H"&&(c="hebrew");v.substring(0,1)==="G"&&(c="greek");l[r]=e(".wordControlPanelTemplate").clone().removeClass("wordControlPanelTemplate").addClass("wordControlPanel");l[r].find(".wordControlPanelStrongsNumber").addClass(d).text(i).data({language:c,lemma:v,range:"verse"});l[r].find(".wordControlPanelLemma").text(s);l[r].find(".wordControlPanelEnglish").text(f);l[r].find(".wordControlPanelStrongsDef").text(o);l[r].find(".wordControlPanelDerivation").text(u);l[r].find(".wordControlPanelKJVDef").html(a);l[r].find(".wordControlPanelMorphology").html(h+": "+javascripture.api.morphology.get(h))}var g="";typeof javascripture.data.strongsObjectWithFamilies[p]!="undefined"&&javascripture.data.strongsObjectWithFamilies[p].roots?e.each(javascripture.data.strongsObjectWithFamilies[p].roots,function(e,t){t.substring(0,1)==="H"&&(c="hebrew");t.substring(0,1)==="G"&&(c="greek");g+='<a href="#search='+t+'" class="'+javascripture.modules.reference.getFamily(t)+' word-tree" data-lemma="'+t+'" data-language="'+c+'">'+t+"</a> "}):g+="No roots";var y="";g===""?y+="<p>no roots</p>":y+="roots: "+g;var b="",w=n.getBranchesMarkup(p);w===""?b+="<p>no branches</p>":b+="branches: "+w;l[r].find("#wordTreeRoots").html(y);l[r].find("#wordTreeBranches").html(b);var E=javascripture.modules.reference.getFamily(p),S="family: "+E;l[r].find("#wordTreeFamily").html(S);var x=parseInt(E.substring(1,E.length),10),T=javascripture.modules.colors.getStrongsColor(x),N=javascripture.modules.colors.getStrongsStyle(E,T);l[r].find("style").html(N)}});e("#wordControlPanel").html(l).show();e.each(l,function(t,n){e("#wordControlPanel").append(n)})},getBranchesMarkup:function(t){var n="";e.each(javascripture.data.strongsObjectWithFamilies,function(r,i){e.each(i,function(e,i){if(i===t){var s;r.substring(0,1)==="H"&&(s="hebrew");r.substring(0,1)==="G"&&(s="greek");n+='<a href="#search='+r+'" class="'+javascripture.modules.reference.getFamily(r)+' word-tree" data-lemma="'+r+'"  data-language="'+s+'">'+r+"</a> "}})});return n}};e(document).on("click","#verse ol > li span",function(t){t.preventDefault();t.stopPropagation();javascripture.modules.wordPanel.init(e(this))});e(document).on("click",".wordControlPanel .close",function(t){t.preventDefault();e("#wordControlPanel").hide()})})(jQuery);