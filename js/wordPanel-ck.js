/*global javascripture*/(function(e){javascripture.modules.wordPanel={init:function(t){var n=this;if(!t.data("lemma"))return!1;var r=t.data("lemma").split(" "),i="",s="",o="",u="",a="",f=[],l,c=t.data("morph");e.each(r,function(r,h){if(h!=="G3588"){if(h!=="added"&&h!=="trans-change"){i=h;var p=javascripture.modules.reference.getFamily(h),d=h;s=javascripture.modules.hebrew.stripPointing(javascripture.data.strongsDictionary[d].lemma);o=javascripture.data.strongsDictionary[d].strongs_def;var v=javascripture.data.strongsDictionary[d].kjv_def.split(",");e.each(v,function(e,t){var n=t.trim();u+='<a href="#" class="kjv-def" data-language="english" data-clusivity="exclusive" data-range="word" data-lemma="'+h+'" data-word="'+n+'">'+n+"</a>, "});a=t.text();d.substring(0,1)==="H"&&(l="hebrew");d.substring(0,1)==="G"&&(l="greek");f[r]=e(".wordControlPanelTemplate").clone().removeClass("wordControlPanelTemplate").addClass("wordControlPanel");f[r].find(".wordControlPanelStrongsNumber").addClass(p).text(i).data({language:l,lemma:d,range:"verse"});f[r].find(".wordControlPanelLemma").text(s);f[r].find(".wordControlPanelEnglish").text(a);f[r].find(".wordControlPanelStrongsDef").text(o);f[r].find(".wordControlPanelKJVDef").html(u);f[r].find(".wordControlPanelMorphology").html(javascripture.api.morphology.get(c))}var m="";typeof javascripture.data.strongsObjectWithFamilies[h]!="undefined"&&javascripture.data.strongsObjectWithFamilies[h].roots?e.each(javascripture.data.strongsObjectWithFamilies[h].roots,function(e,t){t.substring(0,1)==="H"&&(l="hebrew");t.substring(0,1)==="G"&&(l="greek");m+='<a href="#search='+t+'" class="'+javascripture.modules.reference.getFamily(t)+' word-tree" data-lemma="'+t+'" data-language="'+l+'">'+t+"</a> "}):m+="No roots";var g="";m===""?g+="<p>no roots</p>":g+="roots: "+m;var y="",b=n.getBranchesMarkup(h);b===""?y+="<p>no branches</p>":y+="branches: "+b;f[r].find("#wordTreeRoots").html(g);f[r].find("#wordTreeBranches").html(y);var w=javascripture.modules.reference.getFamily(h),E="family: "+w;f[r].find("#wordTreeFamily").html(E);var S=parseInt(w.substring(1,w.length),10),x=javascripture.modules.colors.getStrongsColor(S),T=javascripture.modules.colors.getStrongsStyle(w,x);f[r].find("style").html(T)}});e("#wordControlPanel").html(f).show();e.each(f,function(t,n){e("#wordControlPanel").append(n)})},getBranchesMarkup:function(t){var n="";e.each(javascripture.data.strongsObjectWithFamilies,function(r,i){e.each(i,function(e,i){if(i===t){var s;r.substring(0,1)==="H"&&(s="hebrew");r.substring(0,1)==="G"&&(s="greek");n+='<a href="#search='+r+'" class="'+javascripture.modules.reference.getFamily(r)+' word-tree" data-lemma="'+r+'"  data-language="'+s+'">'+r+"</a> "}})});return n}};e(document).on("click","#verse ol > li span",function(t){t.preventDefault();t.stopPropagation();javascripture.modules.wordPanel.init(e(this))});e(document).on("click",".wordControlPanel .close",function(t){t.preventDefault();e("#wordControlPanel").hide()})})(jQuery);