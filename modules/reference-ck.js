/*globals javascripture*/javascripture.modules.reference={load:function(e){var t=this,n=e.book,r=e.chapter,i=e.verse;"undefined"==typeof i&&(e.verse=1);var s=n;typeof r!="undefined"&&(s+=" "+r);typeof i!="undefined"&&(s+=":"+i);$("head title").text(s);$.fn.waypoint&&$(".reference").waypoint("destroy");$("#verse").html(javascripture.api.reference.getThreeChapters(e));maintainState(n,r,i);return this},scrollToVerse:function(e,t){undefined===t&&(t=0);$(document).scrollTop(0);t-=$(".dock").height();$("html").hasClass("reading-mode")&&(t-=50);e.length>0&&$(document).scrollTo(e,{offset:t});$(document).trigger("createWayPoint")},getAnchoringData:function(e){var t="#current",n=0,r=$(document).scrollTop(),i;if(e){e==="prev"&&(i=$(".reference:first-child ol.wrapper li:first-child"));e==="next"&&(i=$(".reference:last-child ol.wrapper li:last-child"));t="#"+i.attr("id");n=r-i.offset().top+$(".dock").height()}return[n,t]},anchorReference:function(e){var t=e[1],n=e[0],r=$(t);t===".current-verse"&&(verseHeight=r.height(),n=-$(window).height()/2+verseHeight);if(r.length===0){r=$("#"+jsonCollection.currentId);n=-$("[data-role=header]").height()}this.scrollToVerse(r,n)},getFamily:function(e){return javascripture.data.strongsObjectWithFamilies[e]?javascripture.data.strongsObjectWithFamilies[e].family:e},getReferenceFromUrl:function(){var e=window.location.hash.split("&"),t={};if(e.length>1){t.book=e[0].split("=")[1],t.chapter=parseInt(e[1].split("=")[1],10),t.verse=1;e[2]&&(t.verse=parseInt(e[2].split("=")[1],10))}return t},loadReferenceFromHash:function(){var e=window.location.hash;if(e.indexOf("search")>-1){var t=e.split("=")[1];setTimeout(function(){createSearchReferencesPanel({lemma:t})})}else{var n=e.split("&");if(n.length>1){var r=n[0].split("=")[1],i=parseInt(n[1].split("=")[1],10),s=1;n[2]&&(s=parseInt(n[2].split("=")[1],10));localStorage&&(localStorage.reference=[r,i,s]);javascripture.modules.reference.load({book:r,chapter:i,verse:s}).scrollToVerse($("#current"))}}}};