<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="google" content="notranslate" />
		<title>Javascripture</title>
		<link rel="stylesheet" href="css/layout.css" />
		<style id="bodyFontFamily"></style>
		<style id="bodyFontSize"></style>
	</head>
	<body>

<script src="lib/jquery-2.0.3.min.js"></script>

<script>
var javascripture = {
	data: {
		hebrew: {}
	},
	modules: {}
};

</script>
<script src="modules/hebrew.js"></script>

<div id="result"></div>

<script>

function xmlToJson(xml) {

	// Create the return object
	var obj = {};

	if (xml.nodeType == 1) { // element
		// do attributes
		if (xml.attributes.length > 0) {
		obj["@attributes"] = {};
			for (var j = 0; j < xml.attributes.length; j++) {
				var attribute = xml.attributes.item(j);
				obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
			}
		}
	} else if (xml.nodeType == 3) { // text
		obj = xml.nodeValue;
	}

	// do children
	if (xml.hasChildNodes()) {
		for(var i = 0; i < xml.childNodes.length; i++) {
			var item = xml.childNodes.item(i);
			var nodeName = item.nodeName;
			if (typeof(obj[nodeName]) == "undefined") {
				obj[nodeName] = xmlToJson(item);
			} else {
				if (typeof(obj[nodeName].push) == "undefined") {
					var old = obj[nodeName];
					obj[nodeName] = [];
					obj[nodeName].push(old);
				}
				obj[nodeName].push(xmlToJson(item));
			}
		}
	}
	return obj;
};

function jsonToArray( chapters ) {

	// Create the return object
	var bookArray = [];

	// do children
	if ( 'undefined' === typeof chapters.forEach ) {
		bookArray.push( createChapterArray( chapters ) );
	} else {
		chapters.forEach( function( chapterElement ) {
			var chapterArray = createChapterArray( chapterElement );
			bookArray.push( chapterArray );
		} );
	}

	return bookArray;
};
function createChapterArray( chapterElement ) {
	var chapterArray = [];
	chapterElement.verse.forEach( function( verseElement ) {
		var verseArray = [];
		verseElement.w.forEach( function( wordElement ) {
			var wordArray = [];

			var text =  wordElement['#text'];
			var word;
			if ( 'undefined' !== typeof text.replace ) {
				word = javascripture.modules.hebrew.stripPointing( text );
			}

			var lemma = wordElement['@attributes'].lemma;
			var morph = wordElement['@attributes'].morph;

			wordArray[0] = word;
			if ( lemma ) {
				lemma = lemma.replace( / a/g, '').replace( / b/g, '').replace( / c/g, '').replace( / d/g, '').replace( / e/g, '').replace( / f/g, '').replace('+','');
				lemmaArray = lemma.split( /\//);
				lemmaArrayPrefixed = lemmaArray.map( function( lemmaValue) {
					return 'H' + lemmaValue;
				} );
				wordArray[1] = lemmaArrayPrefixed.join('/');
			}
			if ( morph ) {
				if ( 'H' === morph.charAt( 0 ) ) {
					morph = morph.substring( 1 );
				}
				wordArray[2] = morph;
			}
			verseArray.push( wordArray );
		} );
		chapterArray.push( verseArray );
	} );
	return chapterArray;
}

</script>



<script>
	hebrew = {};

	var books = [
		{ bookName: 'Genesis', bookFile: 'Gen.xml' },
		{ bookName: 'Exodus', bookFile: 'Exod.xml'},
		{ bookName: 'Leviticus', bookFile: 'Lev.xml'},
		{ bookName: 'Numbers', bookFile: 'Num.xml'},
		{ bookName: 'Deuteronomy', bookFile: 'Deut.xml'},
		{ bookName: 'Joshua', bookFile: 'Josh.xml'},
		{ bookName: 'Judges', bookFile: 'Judg.xml'},
		{ bookName: 'Ruth', bookFile: 'Ruth.xml'},
		{ bookName: '1 Samuel', bookFile: '1Sam.xml'},
		{ bookName: '2 Samuel', bookFile: '2Sam.xml'},
		{ bookName: '1 Kings', bookFile: '1Kgs.xml'},
		{ bookName: '2 Kings', bookFile: '2Kgs.xml'},
		{ bookName: '1 Chronicles', bookFile: '1Chr.xml'},
		{ bookName: '2 Chronicles', bookFile: '2Chr.xml'},
		{ bookName: 'Ezra', bookFile: 'Ezra.xml'},
		{ bookName: 'Nehemiah', bookFile: 'Neh.xml'},
		{ bookName: 'Esther', bookFile: 'Esth.xml'},
		{ bookName: 'Job', bookFile: 'Job.xml'},
		{ bookName: 'Psalm', bookFile: 'Ps.xml'},
		{ bookName: 'Proverbs', bookFile: 'Prov.xml'},
		{ bookName: 'Ecclesiastes', bookFile: 'Eccl.xml'},
		{ bookName: 'Song of Songs', bookFile: 'Song.xml'},
		{ bookName: 'Isaiah', bookFile: 'Isa.xml'},
		{ bookName: 'Jeremiah', bookFile: 'Jer.xml'},
		{ bookName: 'Lamentations', bookFile: 'Lam.xml'},
		{ bookName: 'Ezekiel', bookFile: 'Ezek.xml'},
		{ bookName: 'Daniel', bookFile: 'Dan.xml'},
		{ bookName: 'Hosea', bookFile: 'Hos.xml'},
		{ bookName: 'Joel', bookFile: 'Joel.xml'},
		{ bookName: 'Amos', bookFile: 'Amos.xml'},
		{ bookName: 'Obadiah', bookFile: 'Obad.xml'},
		{ bookName: 'Jonah', bookFile: 'Jonah.xml'},
		{ bookName: 'Micah', bookFile: 'Mic.xml'},
		{ bookName: 'Nahum', bookFile: 'Nah.xml'},
		{ bookName: 'Habakkuk', bookFile: 'Hab.xml'},
		{ bookName: 'Zephaniah', bookFile: 'Zeph.xml'},
		{ bookName: 'Haggai', bookFile: 'Hag.xml'},
		{ bookName: 'Zechariah', bookFile: 'Zech.xml'},
		{ bookName: 'Malachi', bookFile: 'Mal.xml' }
	];


function rotator(arr) {
    var iterator = function (index) {
    	console.log( index );
        if (index >= arr.length) {
            alert( 'done' );
            document.getElementById( 'result' ).innerHTML = JSON.stringify( hebrew );
        } else {
	        var book = arr[index];
	        console.log( book );
			$.get( '../morphhb/wlc/' + book.bookFile, function( data ) {
				var json = xmlToJson( data ).osis.osisText.div.chapter;
				hebrew[ book.bookName ] = jsonToArray( json );
				iterator(++index);
			} );
		}
    };

    iterator(0);
};

rotator(books);

	/*for( bookName in books ) {
		var bookFile = books[ bookName ];
		console.log( bookName );
		$.get( '../morphhb/wlc/' + bookFile, function( data ) {
			var json = xmlToJson( data ).osis.osisText.div.chapter;
			hebrew[ bookName ] = jsonToArray( json );
		} );
	}
	$.each( books, function( bookName, bookFile ) {
		$.get( '../morphhb/wlc/' + bookFile, function( data ) {
			var json = xmlToJson( data ).osis.osisText.div.chapter;
			hebrew[ bookName ] = jsonToArray( json );
		} );
	} );*/

		$.get( '../morphhb/wlc/VerseMap.xml', function( data ) {
			var verseMap = xmlToJson( data );
			console.log( verseMap );
		} );

</script>

	</body>
</html>